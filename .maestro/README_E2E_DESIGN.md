# E2E 테스트 설계 (앱 로직 기반)

## 1. 관리자 진입 앱 로직

### 1.1 설정에서의 진입

- **설정** 화면의 "운영자 관리 페이지" 탭 → 항상 `router.push('/admin/login')` 호출.
- URL은 **항상 /admin/login**으로 이동.

### 1.2 /admin/login 도달 시 (admin/_layout.tsx, login.tsx)

| 조건 | 동작 |
|------|------|
| `user` 있음 + `isAdmin === true` + 로딩 완료 | **즉시 `router.replace('/admin')`** → 로그인 화면을 보지 못하고 **관리자 페이지(그룹 게시판 생성)**로 이동 |
| 그 외 (익명 또는 비관리자) | **로그인 화면** 표시 ("관리자 로그인", 이메일/비밀번호 입력) |

즉, **이미 로그인한 관리자**가 "운영자 관리 페이지"를 탭하면 로그인 화면이 아니라 **관리자 페이지로 바로 이동**한다.

### 1.3 홈에서의 진입

- **이미 관리자로 판별된 경우**에만 홈 헤더에 "관리자" 버튼 노출.
- "관리자" 탭 → `router.push('/admin')` → **로그인 없이** 관리자 페이지로 이동.

---

## 2. E2E 테스트 설계 원칙

### 2.1 관리자 로그인 시나리오

- **목적**: "설정 → 운영자 관리 페이지 → 로그인 화면 → 로그인 → 관리자 페이지" 경로 검증.
- **전제**: 이 경로를 타려면 **익명 세션**이어야 함. 이미 관리자로 로그인된 상태면 "운영자 관리 페이지" 탭 후 로그인 화면이 아닌 관리자 페이지로 바로 이동하므로, "관리자 로그인"을 기대하는 현재 스텝이 실패함.
- **설계**: 관리자 관련 시나리오(admin-login, admin-create-group, admin-logout, admin-create-group-invite-test)는 **시나리오 시작 시 앱 재시작(stopApp + launchApp)**으로 **항상 익명 세션**에서 시작하도록 한다. 그러면 "운영자 관리 페이지" 탭 후 항상 로그인 화면이 나와 일관되게 검증 가능.

### 2.2 공통 플로우 역할

| 플로우 | 용도 |
|--------|------|
| `common/launch-app.yaml` | 앱 포그라운드(launchApp) + 홈 대기. **세션 유지** (이미 로그인된 상태면 그대로 유지). app-launch, groups-join-by-invite 등에 사용. |
| `common/launch-app-fresh.yaml` | **stopApp + launchApp** + 홈 대기. **익명 세션 보장**. 관리자 로그인/그룹 생성/로그아웃/초대코드 테스트에 사용. |

### 2.3 시나리오별 진입점

| 시나리오 | 시작 | "운영자 관리 페이지" 탭 후 기대 화면 |
|----------|------|--------------------------------------|
| app-launch | launch-app (세션 유지) | - |
| admin-login | **launch-app-fresh** (익명) | 관리자 로그인 화면 |
| admin-create-group | **launch-app-fresh** (익명) | 관리자 로그인 화면 |
| admin-logout | **launch-app-fresh** (익명) | 관리자 로그인 화면 |
| admin-create-group-invite-test | **launch-app-fresh** (익명) | 관리자 로그인 화면 |
| groups-join-by-invite | launch-app (세션 유지) | - |

---

## 3. 요약

- **앱**: 관리자 로그인 후 다시 "운영자 관리 페이지"를 탭하면 로그인 페이지가 아니라 관리자 페이지로 이동하는 것이 정상 동작이다.
- **E2E**: 관리자 로그인/그룹 생성/로그아웃/초대코드 시나리오는 **앱 재시작으로 익명 세션을 보장**한 뒤 "운영자 관리 페이지" → 로그인 화면 → 로그인 → 관리자 페이지 흐름을 검증한다.
